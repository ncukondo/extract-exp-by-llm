# 仕様

## API仕様(近藤により実装)

- エントリーポイント: `https://extract-exp-by-llm.vercel.app/api`
- ダミー用エントリーポイント: `https://extract-exp-by-llm.vercel.app/api/dummy`
- POSTのみを受け付ける。入力・出力共にjson形式。

### 入力

```typescript
type Input = {
    key: "ncukondo@gmail.com"; // 他からの乱用を避けるため、この文字列が正しい場合のみ処理を行う
    data: {
        id: string;
        content: string;
    }[];
}
```

### 出力

ChatGPTにより、上記の入力における`content`を解析し、コアカリキュラムのコードを抽出する。

```typescript
type Output = {
    status: "success";
    data: ({
        id: string;
        status: "success";
        codes: string[];
        url: string;
    } | {
        id: string;
        message: string;
        status: "failure";
    })[];
} | {
    status: "failure";
    message: string;
}
```

## Power Automate仕様(ソフィア研究所で実装願います)

1. 定期実行
   - 毎週金曜日の17:00に実行
   - ただし金曜日が祝日の場合は、翌週の金曜日に実行
2. 実行内容
   1. 臨床実習日々の記録を取得
   2. 学生の記録を1週間分まとめる
       - 但し前の週の金曜日が祝日の場合は、2週間分まとめる
       - 1件も記録がない学生はスキップする
   3. まとめた記録を`content`とし、学生のIDを`id`としてAPIに送信
   4. APIの出力をSharepointリストに保存(Sharepointリストの作成もあわせてお願いいたします(列: 日付, ID, input, response)。)
   5. 学生にメールを送信
     - レスポンスのurlをメールに記載する
     - 処理を失敗した場合にはメールは送信しない

## 対象とする記録

- 2024/4/15からの臨床実習IIにおいて記録された名古屋大学医学部の全ての学生記録

## 学生の記録の形式

学生ごとに、以下の形式で1週間分の記録を集約する

```text
実習先: {診療科名}

{日付}

【患者リスト】
{患者リスト}

【実習事項】
{実習事項}

【学んだこと】
{学んだこと}

【今後の課題】
{今後の課題}

... 日付分繰り返す
```

## 学生へのメールの形式

```text
from: kondo.takeshi.g4@f.mail.nagoya-u.ac.jp
件名: 実習記録からの経験の抽出と修正のお願い

{学生名}さん

{学生名}さんの今週の実習記録を元に、モデル・コア・カリキュラムで求められる経験のうち、どのようなものを経験したのかをAIを用いて抽出しました。

以下のリンクから、抽出された経験を確認し、実際に自分が経験したものと違っている場合には修正の上で送信をお願いします。修正が必要ない場合には、そのまま送信してください。

{url}

この記録は、今後の実習の計画立案や、実習の振り返りに活用されます。入力は数分で完了しますので、ぜひご協力をお願いいたします。

---
名古屋大学医学部附属病院
総合診療科/総合医学教育センター
近藤猛
```